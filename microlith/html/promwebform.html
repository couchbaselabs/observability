<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <title>Generate Prometheus Endpoint Configuration</title>
    </head>
    <body>
        <h2>Configuration</h2>
        <div>
            <form name="inputForm" id="inputForm">
                <fieldset>
                    <legend>
                        <h2>Prometheus endpoint configuration</h2>
                    </legend>
                    <div>
                        <label for="endpoint">Couchbase Server name (for metrics):</label>
                        <input type="text" name="serverName" id="serverName" placeholder="db1" required>
                        <label for="endpoint">Couchbase Server Prometheus endpoint:</label>
                        <input type="text" name="endpoint" id="endpoint" placeholder="127.0.0.1:9090" required>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>
                        <h2>Couchbase Healthchecker configuration</h2>
                    </legend>
                    <div>
                        <label for="serverUser">Couchbase Server Username:</label>
                        <input type="text" name="serverUser" id="serverUser" placeholder="Administrator" required>
                        <label for="serverPwd">Couchbase Server Password:</label>
                        <input type="text" name="serverPwd" id="serverPwd" placeholder="password" required>
                        <label for="serverUrl">Couchbase Server URL:</label>
                        <input type="text" name="serverUrl" id="serverUrl" placeholder="http://db1:8091" required>
                    </div>
                </fieldset>
                <div>
                    <button type="submit" name="generateButton" id="generateButton" onClick="generate();return false;">Generate</button>
                </div>
            </form>
        </div>
        <h2>Prometheus configuration</h2>
        <div>
            <pre id="jsonPrometheus" name="jsonPrometheus"></pre>
        </div>
        <h2>Couchbase Healthcheck configuration</h2>
        <div>
            <p>Execute this command to register a Couchbase Server cluster with the local Healthcheck process.</p>
            <textarea name="healthcheckCommand" id="healthcheckCommand" class="generatedCode" onclick="this.focus();this.select()" readonly></textarea>
        </div>
    <script>
        function generate(form) {
            var output = [
                            {
                            "targets": [
                                document.inputForm.endpoint.value
                            ],
                            "labels": {
                                "job": document.inputForm.serverName.value
                                }
                            }
                        ]
            document.getElementById("jsonPrometheus").innerHTML = JSON.stringify(output, undefined, 2);

            var serverConfig = { "user": document.inputForm.serverUser.value, "password": document.inputForm.serverPwd.value, "host": document.inputForm.serverUrl.value }

            document.getElementById("healthcheckCommand").value = "curl -u ${CLUSTER_MONITOR_USER}:${CLUSTER_MONITOR_PWD} -X POST -d '" + JSON.stringify(serverConfig, undefined, 2) + "' http://localhost:7196/api/v1/clusters"
        }
    </script>
  </body>
</html>