# nfpm example config file
#
# check https://nfpm.goreleaser.com/configuration for detailed usage
#
name: "cbhealthagent"
arch: "${BINARY_ARCH}"
platform: "linux"
version: "${VERSION}"
section: "default"
priority: "extra"
maintainer: "Couchbase <info@couchbase.com>"
vendor: "Couchbase"
contents:
- dst: /opt/cbhealthagent
  type: dir
  file_info:
    owner: couchbase
    group: couchbase
    mode: 0755
- src: ./build/cbhealthagent-${IMAGE_BINARY_TARGET}
  # Must not be named just `cbhealthagent` or Fluent Bit will fail to load cbhealthagent/*.conf
  dst: /opt/cbhealthagent/cbhealthagent-${IMAGE_BINARY_TARGET}
  file_info:
    owner: couchbase
    group: couchbase
    mode: 0755
- src: ./build/fluent-bit-${IMAGE_BINARY_TARGET}-${BINARY_DISTRO}
  dst: /opt/cbhealthagent/fluent-bit-${IMAGE_BINARY_TARGET}
  file_info:
    owner: couchbase
    group: couchbase
    mode: 0755
- src: ./build/etc/fluent-bit
  dst: /opt/cbhealthagent/etc/fluent-bit
  file_info:
    owner: couchbase
    group: couchbase
- src: ./agent/init/cbhealthagent.service
  dst: /usr/lib/systemd/system/cbhealthagent.service
scripts:
  postinstall:
    ./agent/scripts/postinstall
  preremove: ./agent/scripts/preremove
  postremove: ./agent/scripts/postremove
overrides:
  rpm:
    depends:
    - openssl-libs >= 1.0.1e
  deb:
    depends:
    - openssl (>= 1.0.1e)
