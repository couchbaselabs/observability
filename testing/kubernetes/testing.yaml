---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: microlith-test-role
subjects:
- kind: ServiceAccount
  name: microlith-test-role
  namespace: default
roleRef:
  kind: ClusterRole
  name: cluster-admin # Probably doesn't need this.
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: microlith-test-role
---
apiVersion: batch/v1
kind: Job
metadata:
  name: microlith-test
spec:
  template:
    spec:
      serviceAccountName: microlith-test-role
      restartPolicy: Never
      containers:
      - name: tester
        image: %%IMAGE%%
  activeDeadlineSeconds: %%TIMEOUT%%  #Prevent jobs from continuing to spawn for eternity if failing.
  completions: %%COMPLETIONS%%        #Number of completions required for job to succeed
  parallelism: %%PARALLELISM%%       #Number of pods that can run in parallel to reach desired completion
---