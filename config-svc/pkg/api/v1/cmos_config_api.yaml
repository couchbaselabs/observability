openapi: 3.0.3
info:
  title: Couchbase Monitoring & Observability Stack - Configuration Service
  description: REST API of the Configuration Service
  version: v1
  contact:
    name: Couchbase, Inc.
    url: https://couchbase.com
    email: info@couchbase.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  - description: Local Microlith
    url: http://localhost:8080/config/api/v1
  - description: Local Development
    url: http://localhost:7194/api/v1
paths:

  /openapi.json:
    get:
      summary: Outputs the OpenAPI specification for this API.
      responses:
        '200':
          description: OpenAPI 3.0 specification for this API
          content:
            application/json:
              schema:
                type: object

  /addPrometheusTarget:
    post:
      summary: Add a Prometheus target to this CMOS instance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required: [name, labels, targets]
              properties:
                name:
                  type: string
                nameLabel:
                  type: string
                overwrite:
                  type: boolean
                  default: false
                labels:
                  type: object
                  additionalProperties:
                    type: string
                targets:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Prometheus target was added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardResponse"
        '409':
          description: Target already exists and overwrite was not specified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StandardResponse"

components:
  schemas:
    StandardResponse:
      oneOf:
        - type: object
          additionalProperties: false
          required: [ok]
          properties:
            ok:
              type: boolean
              enum: [true]
        - type: object
          additionalProperties: false
          required: [ok, error]
          properties:
            ok:
              type: boolean
              enum: [false]
            error:
              type: string
