<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Health Checks :: Couchbase Monitoring and Observability Stack</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/cmos">Couchbase Monitoring and Observability Stack</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cmos" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Couchbase Monitoring and Observability Stack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quickstart.html">Quick start guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Key Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-microlith.html">Microlith container deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cluster-monitor.html">Couchbase Cluster Monitor</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="health-agent.html">Couchbase Health Agent</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-distributed.html">Distributed microservices deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Metrics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-prometheus.html">Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-exporter.html">Exporter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-fluent-bit.html">Fluent Bit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-loki.html">Loki</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Visualization</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-grafana.html">Grafana</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Alerting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-alertmanager.html">Alertmanager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tracing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-jaeger.html">Jaeger</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configure-cmos.html">CMOS Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security-considerations.html">Security Considerations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deployment</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-onpremise.html">On-premise deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="integrating-with-existing-deployments.html">Integrating with existing monitoring pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-fluentbit.html">Fluent Bit deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-onpremise.html">On-premise example</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-kubernetes.html">Kubernetes example</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-host-level-metrics-node-exporter.html">Host-Level Metrics with the Node Exporter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-systemd-exporter.html">Systemd Exporter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-process-exporter.html">Process Exporter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-pushgateway.html">Pushgateway</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Further Information</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="prerequisite-and-setup.html">Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="licensing.html">Licensing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="support.html">Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cluster-monitor-api.html">Cluster Monitor API</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="health-checks.html">Health Checks</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Couchbase Monitoring and Observability Stack</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Couchbase Monitoring and Observability Stack</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Couchbase Monitoring and Observability Stack</a></li>
    <li>Reference</li>
    <li><a href="health-checks.html">Health Checks</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/couchbaselabs/observability/edit/main/docs/modules/ROOT/pages/health-checks.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Health Checks</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "CB900XX" system of IDs is subject to change in future releases.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cluster_checks"><a class="anchor" href="#_cluster_checks"></a>Cluster Checks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="CB90038"><a class="anchor" href="#CB90038"></a>Stats Collection Failed (CB90038)</h3>
<div class="paragraph">
<p><strong>Background</strong>: The CMOS Prometheus server will scrape all Couchbase Server nodes periodically (every 30 seconds by default) for statistics.
If a node fails to respond, this can indicate that the node is down, its CPU is overloaded, or there is a network issue preventing Prometheus from communicating with it.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Prometheus has failed to scrape a Couchbase Server node.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Check the node&#8217;s status and resource usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90073"><a class="anchor" href="#CB90073"></a>Dropped DCP Mutations (CB90073)</h3>
<div class="paragraph">
<p><strong>Background</strong>: This can be an indication of a Couchbase Server Issue (MB-41255) which was fixed in versions: 6.0.5, 6.5.2 and 6.6.1.
This issue can affect data integrity.
DCP mutations track any documents made to Couchbase Server and do Documents.
If you drop DCP mutations, then changes to documents may be lost.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Dropped DCP mutations found in memcached.log.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: If you experience data integrity issues, update to a more recent version of Couchbase Server.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://issues.couchbase.com/browse/MB-41255">MB-41255</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_node_checks"><a class="anchor" href="#_node_checks"></a>Node Checks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="CB90036"><a class="anchor" href="#CB90036"></a><code>memcached</code> Crashes (CB90036)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the Data Service process (<code>memcached</code>) crashes, it will be restarted within a few seconds.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in the <code>memcached</code> logs.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Contact Couchbase Technical Support.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90041"><a class="anchor" href="#CB90041"></a>CPU Steal (CB90041)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Steal time is the percentage of time a virtual CPU waits for a real CPU while the hypervisor is servicing another virtual processor.
In virtual environments, high CPU steal indicates that the virtual machines might be undersized or the hypervisor may be overcommitted.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: CPU steal rate is greater than 3%.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Increase resources available to virtual machine.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/install/best-practices-vm.html">Virtualisation Best Practices</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90043"><a class="anchor" href="#CB90043"></a>Disk Commit Fail (CB90043)</h3>
<div class="paragraph">
<p><strong>Background</strong>: A disk commit failure is when Couchbase Server cannot write data from memory to the file system.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: An item failed to be written to disk.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review your infrastructure for signs of disk problems or any other issues, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/buckets-memory-and-storage/storage.html">Storage</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90044"><a class="anchor" href="#CB90044"></a>Babysitter Managed Process Crash (CB90044)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Babysitter is part of Couchbase Server&#8217;s cluster manager which is responsible for maintaining a variety of Couchbase Server processes.
If any of the processes managed by the babysitter die, it is responsible for restarting them.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A process managed by babysitter crashes.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: A process can crash for a number of reasons, so if it happens once or twice it is not indicative of a Couchbase Server issue.
However, if it is happening repeatedly or you do notice disruption in your cluster please contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/clusters-and-availability/cluster-manager.html">Cluster Manager</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90046"><a class="anchor" href="#CB90046"></a>Indexer Crash (CB90046)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the Index Service process (<code>indexer</code>) crashes, it will be restarted within a few seconds by the cluster manager.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in <code>indexer</code> logs.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review <code>indexer.log</code> to identify the cause, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/services-and-indexes/services/index-service.html">Index Service</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90048"><a class="anchor" href="#CB90048"></a>Cross Data Center Replication (XDCR) Crash (CB90048)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the XDCR process (<code>goxdcr</code>) crashes, it will be restarted within a few seconds by the cluster manager.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in <code>goxdcr</code> logs.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review <code>goxdcr.log</code> to identify the cause, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/clusters-and-availability/xdcr-overview.html">Cross Data Center Replication</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90049"><a class="anchor" href="#CB90049"></a>Full Text Search (FTS) Crash (CB90049)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the FTS Service process (<code>cbft</code>) crashes, it will be restarted within a few seconds by the cluster manager.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in <code>cbft</code> logs.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review <code>fts.log</code> to identify the cause, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/services-and-indexes/services/search-service.html">Search Service</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90050"><a class="anchor" href="#CB90050"></a>Eventing Crash (CB90050)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the Eventing Service process crashes, it will be restarted within a few seconds by the cluster manager.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in <code>eventing.log</code>.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review <code>eventing.log</code> to identify the cause, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/services-and-indexes/services/eventing-service.html">Eventing Service</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90051"><a class="anchor" href="#CB90051"></a>Analytics Crash (CB90051)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If the Analytics Service process (<code>cbas</code>) crashes, it will be restarted within a few seconds by the cluster manager.
However, repeated crashes should be investigated as they may be caused by an underlying issue.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A crash is seen in <code>cbas</code> logs.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review <code>analytics_debug.log</code> to identify the cause, or contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/services-and-indexes/services/analytics-service.html">Analytics Service</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90056"><a class="anchor" href="#CB90056"></a>Memcached Connections Rejected (CB90056)</h3>
<div class="paragraph">
<p><strong>Background</strong>: If <code>memcached</code> (the Data Service) has too many open connections then it won&#8217;t allow any new ones to be made.
This will result in client errors on applications attempting to connect to Couchbase Server</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: The number of open connections to <code>memcached</code> reaches its limit.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Contact your network/application team to see if there are any applications keeping open a large number of connections.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/rest-api/rest-manage-cluster-connections.html">Manage Cluster Connections</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_memcached_time_jumps_cb90057"><a class="anchor" href="#_memcached_time_jumps_cb90057"></a>Memcached Time Jumps (CB90057)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Memcached time jumps occur when the <code>memcached</code> process has not been scheduled by the CPU, or not scheduled enough for a significant period of time.
Time jumps are the result of underlying issues (e.g. over provisioning or VM resource contention) with the machine that Couchbase Server is running on, particularly in virtualised environments.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Memcached detected a time jump.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Check for evidence of your node being over provisioned or for evidence of VM resource contention.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/install/best-practices-vm.html">Virtualisation Best Practices</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_dropped_ticks_cb90062"><a class="anchor" href="#_dropped_ticks_cb90062"></a>Dropped Ticks (CB90062)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Couchbase Server nodes regularly send heartbeat ticks to each other.
If the Cluster Manager logs <code>dropped ticks</code> this means when it tried to process a tick, it found other ticks that had not been processed yet.
In other words, due to a scheduling issue the Cluster Manager was not able to process the previous tick in time.
Dropped ticks are usually a sign of resource contention, specifically CPU contention.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Can be triggered by either detecting over 10 dropped ticks on a node or by detecting over 4 instances of dropped ticks occurring on a node within a one hour time frame.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Increase number of CPUs available to Couchbase Server or, if you are running a virtualised environment, check for VM overcommitment.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="#7.0@server:install:sizing-general">Sizing Guidelines</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90067"><a class="anchor" href="#CB90067"></a>Service DCP Rollback to Zero (CB90067)</h3>
<div class="paragraph">
<p><strong>Background</strong>: A service has been forced to DCP rollback to zero.
A DCP rollback is when the Data Service connects to a client with newer mutations that are not present on the Data Service.
The client must rollback or undo some mutations to align with the mutations on the Data Service.
If the client is rolled back to 0, it means the service is attempting to resynchronize the entirety of the data set.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: A DCP rollback to zero is seen in the <code>memcached</code> logs in the last hour.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: This is typically a symptom of another problem, you should monitor your cluster closely for any further issues.
If you experience any, then please contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://blog.couchbase.com/couchbase-dcp-rollback-qa-tests/">Couchbase DCP Rollback</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90070"><a class="anchor" href="#CB90070"></a>Permission Denied Errors (CB90070)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Couchbase Server has been denied permission to access resources.
This is potentially due to other applications locking Couchbase Server files, or misconfiguration.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Found permission denied errors in memcached.log.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Check that there are no other applications locking files in your Couchbase Server directory, and that permissions are correctly configured.
If this does not solve the problem, please contact Couchbase Support.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90072"><a class="anchor" href="#CB90072"></a>Data Service Connection Limit (CB90072)</h3>
<div class="paragraph">
<p><strong>Background</strong>: By default, the maximum number of connections to the Data Service is limited to 65,000, of which 5,000 are reserved for internal system services.
If this limit is exceeded, clients will fail to connect to your Couchbase cluster.</p>
</div>
<div class="paragraph">
<p>The default limit is high enough that it is unlikely to be legitimately exceeded in production.
If it is exceeded, the most likely cause is application code failing to shut down connections properly.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Warning if the number of connections is above 80% of the default limit (60,000).
Upgraded to an alert if the limit is exceeded, or log messages are seen that indicate that client connections are being rejected because of the limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to modify this limit.
However, if this is done, you will need to adjust this health check&#8217;s threshold accordingly, otherwise it may produce false positives or negatives.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review your application code to ensure that it is closing Couchbase connections properly.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/rest-api/rest-manage-cluster-connections.html">Managing Cluster Connections</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bucket_checks"><a class="anchor" href="#_bucket_checks"></a>Bucket Checks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="CB90033"><a class="anchor" href="#CB90033"></a>Long DCP Names (CB90033)</h3>
<div class="paragraph">
<p><strong>Background</strong>: All Database Change Protocol (DCP) streams, including internal replication streams, have an internal name.
Before Couchbase Server 7.0, this was implicitly limited to 255 characters (or fewer in some cases), and DCP names that exceed this threshold could result in rebalance failures and other issues.
As of Couchbase Server 7.0, these names are explicitly limited to 200 characters.
This means that an online upgrade to 7.0 could fail if names longer than 200 but shorter than 255 characters are present.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: DCP stream names longer than 200 characters are present, or errors related to them are seen.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Contact Couchbase Technical Support for analysis.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://issues.couchbase.com/browse/MB-34280">MB-34280</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90037"><a class="anchor" href="#CB90037"></a>Slow Operations (CB90037)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Data Service operations that take longer than 500ms will be logged.
Seeing one or two should not always be cause for concern, but consistent numbers of slow operations may indicate resource contention on your Data Service nodes.
Note that this is different to slow operations logged by the Couchbase SDKs - this health check is purely server-side.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Slow operations logged by the Data Service.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Verify that your Data Service nodes have adequate system resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90052"><a class="anchor" href="#CB90052"></a>Malformed vBuckets (CB90052)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Files stored in a Bucket have become corrupted and attempting to read specific parts of those files results in a checksum error. This is normally the result of some issue with the underlying disk / file system / OS - either the data on-disk was corrupted at the time it was written, or the data has subsequently become corrupted and hence it cannot be successfully read.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: vBucket detected by Couchbase Server containing corrupted data.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review your infrastructure for signs of disk problems or any other issues.
Alternatively, navigate to your Data storage directory and enter the following command, making sure to fill in the correct data: <code>/opt/couchbase/bin/couch_dbck --verbose --json &lt;couchbase_server_data_directory&gt;/&lt;bucket&gt;/&lt;malformed_vb_file&gt;</code>, then take the response and provide it to Couchbase Technical Support.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90055"><a class="anchor" href="#CB90055"></a>Metadata Overhead (CB90055)</h3>
<div class="paragraph">
<p><strong>Background</strong>: As Couchbase Server stores all of its working documents in memory, if a large portion of that memory is taken up by metadata it can impact performance and force useful documents to be stored on disk rather than memory.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Over 50% of memory is taken up by metadata.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Increase memory allocation for bucket or change the <a href="https://docs.couchbase.com/server/current/manage/manage-buckets/edit-bucket.html#making-changes">evictionPolicy</a> of the bucket from <code>Value-only</code> (be aware this will have an adverse effect on performance).</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/learn/data/data.html#metadata">Metadata</a>, <a href="https://docs.couchbase.com/server/current/rest-api/rest-bucket-create.html#evictionpolicy">evictionPolicy</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="CB90061"><a class="anchor" href="#CB90061"></a>Disk Write Queue (CB90061)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Having items in the Disk Write Queue for too long could cause applications to backoff and writes to fail.
This usually indicates either a sizing issue, or a storage medium failing.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: If the time since the object most recently persisted to disk was added to the Disk Write Queue is over 50 seconds, a warning is produced.
If that time breaches 100 seconds, then a critical alert is produced.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Review your hardware for malfunctions or sizing issues.
If the problem persists, then please contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="#7.0@server:metrics-reference:data-service-metrics.adoc#kv_ep_storage_age_second" class="page unresolved">Data Service Metrics</a>, <a href="#7.0@server:install:sizing-general.adoc#sizing-data-service-nodes" class="page unresolved">Sizing Data Service Nodes</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CB90071"><a class="anchor" href="#CB90071"></a>Compaction Failure (CB90071)</h3>
<div class="paragraph">
<p><strong>Background</strong>: Auto-Compaction can be set to run either at a specific time, or when fragmentation hits a specific level.
Auto-Compaction requires some free space on disk in order to run, so if there is none available then compaction cannot run.</p>
</div>
<div class="paragraph">
<p><strong>Condition</strong>: Auto-Compaction on bucket can fail if there is insufficient disk space available.</p>
</div>
<div class="paragraph">
<p><strong>Remediation</strong>: Allocate more storage to existing Data Service nodes, or more Data Service nodes to the cluster, and attempt to rerun Auto-Compaction.
You may also create a new cluster, with more storage, and use unidirectional XDCR to transfer the files over, which should give you the space required for Auto-Compaction.
If that is not possible, please contact Couchbase Technical Support.</p>
</div>
<div class="paragraph">
<p><strong>Further Reading</strong>: <a href="https://docs.couchbase.com/server/current/manage/manage-settings/configure-compact-settings.html">Auto-Compaction</a></p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
