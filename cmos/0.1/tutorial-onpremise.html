<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure CMOS for On-premises deployment :: Couchbase Monitoring and Observability Stack</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/cmos">Couchbase Monitoring and Observability Stack</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cmos" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Couchbase Monitoring and Observability Stack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quickstart.html">Quick start guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-microlith.html">Microlith container deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cluster-monitor.html">Couchbase Cluster Monitor component</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-distributed.html">Distributed microservices deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="component-alertmanager.html">Alertmanager</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="component-grafana.html">Grafana</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="component-loki.html">Loki</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="component-prometheus.html">Prometheus</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configure-cmos.html">CMOS Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deployment</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-onpremise.html">On-premise deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="integrating-with-existing-deployments.html">Integrating with existing monitoring pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="deployment-fluentbit.html">Fluent Bit deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="tutorial-onpremise.html">On-premise example</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tutorial-kubernetes.html">Kubernetes example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Further Information</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="prerequisite-and-setup.html">Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="health-checks.html">Health Checks</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="licensing.html">Licensing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="support.html">Support</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Couchbase Monitoring and Observability Stack</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Couchbase Monitoring and Observability Stack</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Couchbase Monitoring and Observability Stack</a></li>
    <li>Tutorials</li>
    <li><a href="tutorial-onpremise.html">On-premise example</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/couchbaselabs/observability/edit/main/docs/modules/ROOT/pages/tutorial-onpremise.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure CMOS for On-premises deployment</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tutorials are provided to demonstrate how a particular problem may be solved.
Tutorials are accurate at the time of writing but rely heavily on third party software.
The third party software is not directly supported by Couchbase.
For further help in the event of a problem, contact the relevant software maintainer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Monitoring and Observability Stack (also known as CMOS) is a simple, out-of-the-box solution built using industry standard tooling to observe the state of a Couchbase cluster.
CMOS can be deployed using Docker or any container runtime.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/microlith-runtime.png" alt="microlith runtime">
</div>
<div class="title">Figure 1. Microlith runtime image</div>
</div>
<div class="sect2">
<h3 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h3>
<div class="paragraph">
<p>At this moment, we only support deployment of CMOS using containers.
Use docker to start the CMOS container.
Alternatively, you can also use Linux container tools such as <a href="https://podman.io" target="_blank" rel="noopener">Podman</a>.
To install CMOS run the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">docker run --name=cmos --rm -d -P couchbase/observability-stack:latest</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_port_configuration"><a class="anchor" href="#_port_configuration"></a>Port Configuration</h4>
<div class="paragraph">
<p>CMOS contains multiple services, each running on their own default port such as Grafana (3000), Prometheus (9090), Alertmanager (9093), Landing page (8080), and Loki (3100).
You can also access different services using path-based routing through the landing page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verification"><a class="anchor" href="#_verification"></a>Verification</h3>
<div class="paragraph">
<p>You can verify whether the CMOS container is up and running by navigating to the CMOS landing page on port 8080.</p>
</div>
<div class="paragraph">
<p>To check the port mapping in your host, run the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">docker container port cmos 8080</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># output
0.0.0.0:55124
:::55124</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/cmos-landing.png" alt="cmos landing">
</div>
<div class="title">Figure 2. CMOS landing image</div>
</div>
<div class="sect3">
<h4 id="_add_cluster"><a class="anchor" href="#_add_cluster"></a>Add Cluster</h4>
<div class="paragraph">
<p>If you don&#8217;t have an existing Couchbase cluster setup, you can install it from <a href="https://docs.couchbase.com/server/current/install/getting-started-docker.html#section_jvt_zvj_42b" target="_blank" rel="noopener">here</a>.
To monitor a Couchbase cluster, you can add it using the add cluster option on the landing page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/add-cluster-vm.png" alt="add cluster vm">
</div>
<div class="title">Figure 3. Add cluster image</div>
</div>
<div class="paragraph">
<p>As soon as you add a cluster, you will see a Grafana URL where you can view inventory and metrics of Couchbase server clusters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/couchbase-inventory-vm.png" alt="couchbase inventory vm">
</div>
<div class="title">Figure 4. Couchbase inventory image</div>
</div>
</div>
<div class="sect3">
<h4 id="_prometheus"><a class="anchor" href="#_prometheus"></a>Prometheus</h4>
<div class="paragraph">
<p>From the landing page, you can go to the prometheus target page and check if the added cluster target is up or down.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prometheus-target-vm.png" alt="prometheus target vm">
</div>
<div class="title">Figure 5. Prometheus target image</div>
</div>
</div>
<div class="sect3">
<h4 id="_grafana"><a class="anchor" href="#_grafana"></a>Grafana</h4>
<div class="paragraph">
<p>From the landing page, you can go to Grafana and check the graphs.
CMOS comes with pre-installed dashboards to monitor the Couchbase cluster.
Dashboards with tag <code>couchbase-7</code> are relevant for Couchbase server version 7+.
For more information, check the Grafana configuration section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/couchbase-cluster-overview-vm.png" alt="couchbase cluster overview vm">
</div>
<div class="title">Figure 6. Couchbase cluster overview image</div>
</div>
</div>
<div class="sect3">
<h4 id="_alerts"><a class="anchor" href="#_alerts"></a>Alerts</h4>
<div class="paragraph">
<p>CMOS comes with pre-installed alert rules to monitor the Couchbase cluster.
Navigate to the Prometheus UI to see the rules, or Alertmanager to see the alerts.
For more information check the prometheus and alerting configuration section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prometheus-alert-rules.png" alt="prometheus alert rules">
</div>
<div class="title">Figure 7. Alert rules image</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prometheus-alerts.png" alt="prometheus alerts">
</div>
<div class="title">Figure 8. Alerts image</div>
</div>
</div>
<div class="sect3">
<h4 id="_loki"><a class="anchor" href="#_loki"></a>Loki</h4>
<div class="paragraph">
<p>Loki, which is shipped with Grafana, allows access to logs of various components.
You can configure it via Configuration &gt; Data sources &gt; Loki &gt; Explore.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will need to install and configure Fluent Bit on your Couchbase Server nodes before logs will be sent to Loki.
Refer to the <a href="deployment-fluentbit.html" class="page">Fluent Bit install guidance</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/loki-explore-dashboard.png" alt="loki explore dashboard">
</div>
<div class="title">Figure 9. Loki explore dashboard image</div>
</div>
<div class="paragraph">
<p>From the Log browser, you can enter a custom Loki query or select appropriate labels to see the logs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/loki-log-browser.png" alt="loki log browser">
</div>
<div class="title">Figure 10. Loki log browser image</div>
</div>
<div class="paragraph">
<p>After that select the “Show logs” to view logs.
You can also build  <a href="https://grafana.com/docs/grafana/latest/getting-started/getting-started/#step-3-create-a-dashboard" target="_blank" rel="noopener">custom Grafana dashboards</a> based on your needs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/loki-logs.png" alt="loki logs">
</div>
<div class="title">Figure 11. Loki logs image</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next steps</h3>
<div class="ulist">
<ul>
<li>
<p><a href="architecture.html" class="page">Architecture overview</a></p>
</li>
<li>
<p><a href="deployment-microlith.html" class="page">Microlith container deployment</a></p>
</li>
<li>
<p><a href="cluster-monitor.html" class="page">Couchbase Cluster Monitor component</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
